# IEEE SA P3109 Floating-Point Concepts

This package was designed for **IEEE SA P3109** - a standard for low-precision floating-point formats optimized for machine learning and AI workloads.

## Overview

IEEE SA P3109 specifies:
- **Binary floating-point formats** smaller than IEEE 754 binary32
- **Operations** on these formats with defined precision guarantees
- **Approximation bounds** (κ values) for transcendental functions
- **Conformance profiles** for implementations

## Binary Format Naming Convention

Formats follow the pattern: `Binary{bitwidth}p{precision}{signedness}{exponent}`

| Component | Meaning | Examples |
|-----------|---------|----------|
| `{bitwidth}` | Total bits | `8`, `10`, `16` |
| `p{precision}` | Precision bits (significand) | `p3`, `p4`, `p6` |
| `{signedness}` | `s` = signed, `u` = unsigned | `s`, `u` |
| `{exponent}` | `e` = with exponent, `f` = fixed-point | `e`, `f` |

### Examples

| Format | Bits | Precision | Signed | Exponent |
|--------|------|-----------|--------|----------|
| `Binary8p3se` | 8 | 3 | Yes | Yes |
| `Binary8p4se` | 8 | 4 | Yes | Yes |
| `Binary10p6se` | 10 | 6 | Yes | Yes |
| `Binary4p1sf` | 4 | 1 | Yes | No (fixed) |

### Format Property Functions

P3109 defines functions to query format properties:

| Function | Returns |
|----------|---------|
| `BitwidthOf(format)` | Total bit width |
| `PrecisionOf(format)` | Significand precision |
| `ExponentBitsOf(format)` | Exponent field width |
| `ExponentBiasOf(format)` | Exponent bias value |
| `SignednessOf(format)` | Sign handling |
| `DomainOf(format)` | Representable value range |

## Kappa (κ) Values

**Kappa (κ)** measures the maximum error of an approximate function in **ULPs** (Units in Last Place).

| κ Value | Meaning |
|---------|---------|
| 0 | Correctly rounded (exact to format precision) |
| 1 | At most 1 ULP error |
| 2 | At most 2 ULPs error |
| n | At most n ULPs error |

### Kappa Specification Structure

```yaml
SqrtFast:
  Approximates: "Sqrt"
  Kappa:
    - intervals: "([-Inf, Inf])"  # Input range
      kappa: 1                     # Max error in ULPs
  Projections:
    RoundingModes: ["NearestTiesToAway", "AllDirected"]
    SaturationModes: "All"
```

### Interval-Dependent Kappa

Kappa values can vary by input interval:

```yaml
ExpFast:
  Kappa:
    - intervals: '[-1, 1]'
      kappa: 0                    # Exact in [-1, 1]
    - intervals: ['[-10, -1)', '(1, 12]']
      kappa: 1                    # 1 ULP outside core range
    - intervals: ['(-Inf, -10)', '(12, Inf)']
      kappa: 2                    # 2 ULPs at extremes
```

## Projection Modes

### Rounding Modes

Control how intermediate results are rounded to target precision:

| Category | Modes |
|----------|-------|
| **Nearest** | `NearestTiesToEven` (IEEE default), `NearestTiesToAway` |
| **Directed** | `TowardPositive`, `TowardNegative`, `TowardZero` |
| **Special** | `ToOdd` (for reproducibility) |
| **Stochastic** | `StochasticA`, `StochasticB`, `StochasticC` |

**Stochastic rounding** adds controlled randomness, useful for training neural networks:

```yaml
StochasticA:
  bits: 16  # Random bits used for rounding decision
```

### Saturation Modes

Control overflow/underflow behavior:

| Mode | Description |
|------|-------------|
| `OvfInf` | Overflow to ±Infinity (IEEE 754 behavior) |
| `SatFinite` | Saturate to maximum finite value |
| `SatPropagate` | Propagate saturation status |

## Operation Categories

P3109 organizes operations into categories:

### Classification

Predicates for value classification:
- `IsZero`, `IsOne`, `IsNan`, `IsSignMinus`
- `IsFinite`, `IsInfinite`, `IsNormal`, `IsSubnormal`

### Comparison

- `CompareLess`, `CompareLessEqual`, `CompareEqual`
- `CompareGreaterEqual`, `CompareGreater`
- `TotalOrder` (includes NaN ordering)

### Extrema

- **Value**: `Minimum`, `Maximum`, `MinimumNumber`, `MaximumNumber`
- **Magnitude**: `MinimumMagnitude`, `MaximumMagnitude`
- **Bound**: `Clamp`

### Math Operations

| Subcategory | Operations |
|-------------|------------|
| **Sign** | `Negate`, `Abs`, `CopySign` |
| **Arithmetic** | `Add`, `Subtract`, `Multiply`, `Divide`, `FMA`, `FAA` |
| **Root** | `Sqrt`, `Rsqrt`, `Recip`, `Hypot` |
| **Exp/Log** | `Exp`, `Exp2`, `Log`, `Log2`, `Softplus` |
| **Trigonometric** | `Sin`, `Cos`, `Tan`, `ArcSin`, `ArcCos`, `ArcTan` |
| **Hyperbolic** | `Sinh`, `Cosh`, `Tanh`, `ArcSinh`, `ArcCosh`, `ArcTanh` |

### Block Operations

SIMD-style operations on vectors:
- `BlockAdd`, `BlockMultiply`, `BlockFMA`
- `BlockReduceAdd`, `BlockDotProduct`
- `BlockExp`, `BlockLog`, `BlockSoftplus`

### Conversion

- `Convert` - Between P3109 formats
- `ConvertToIEEE754` / `ConvertFromIEEE754` - Interop with `binary32`/`binary64`

## Constraints

Operation constraints specify valid input/output format combinations:

```yaml
Core32:
  - 'Add{fx, fy, fr}':
    - "(fx == fy && fy == fr)"  # All formats must match
    
  - 'Multiply{fx, fy, fr}':
    - "(fx == fy)"                              # Input formats match
    - "(BitwidthOf(fr) >= BitwidthOf(fx))"      # Result not narrower
    - "(PrecisionOf(fr) >= PrecisionOf(fx))"    # Result not less precise
```

## References

- [IEEE SA P3109 Working Group](https://github.com/P3109/Public)
- [P3109 Interim Report v3.2.0](https://github.com/P3109/Public)
